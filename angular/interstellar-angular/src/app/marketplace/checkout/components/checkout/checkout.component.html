
<button (click)="returnToCart()"> Return to Cart </button>

<mat-vertical-stepper class="col-md-10" style="border: 1px solid rgb(224,224,244); border-radius: 3px; margin: auto;" [linear]="true" #stepper="matVerticalStepper">
    <!-- Step One -->
    <mat-step [stepControl]="firstFormGroup" #stepOne editable="false">
        <ng-template matStepLabel> Review product details </ng-template>
        <div>
            <div *ngFor="let product of checkoutItemsSource | async">
                <img src="{{ cartItem?.productThumbnailLink }}" alt="alt">
                <div>
                    <p> Product Name: {{ product.productName }} </p>
                    <p> Fixed USD Amount ($): {{ product.fixedUSDAmount }} </p>
                    <p> Quantity: {{ product.quantityPurchased }} </p>
                    <p> Current Asset Value: {{ product.assetPricePerItem }} </p>
                    <p> Total Asset Value: {{ product.assetPurchaseDetails.balance }} {{ product.assetPurchaseDetails.asset_type
                        }} </p>
                </div>
            </div>
            <form [formGroup]="firstFormGroup">
                <!-- (change)="checkItem()" -->
                <mat-checkbox formControlName="firstCtrl"> Confirm </mat-checkbox>
                <!-- <button mat-button [disabled]="!hasItems" (click)="updateStep(stepper.selectedIndex)" matStepperNext> -->
                <!-- [disabled]="!firstFormGroup.valid" -->
                <button mat-button [disabled]="!firstFormGroup.valid" (click)="updateStep(stepper.selectedIndex)" matStepperNext>
                    Confirm
                </button>
            </form>
        </div>
    </mat-step>
    <!-- End Step One -->
    <!-- Step Two -->
    <mat-step [stepControl]="secondFormGroup" #stepTwo editable="false">
        <div>
            <ng-template matStepLabel> Confirm secret key </ng-template>
            <form [formGroup]="secondFormGroup">

                <input type="password" class="form-control" matInput placeholder="Secret Key" id="checkoutSecretKey" #checkoutSecretKey formControlName="secondCtrl">
                <!-- <div *ngIf="secondCtrl.errors.minlength">
                        Secret key must be 56 characters long.
                </div> -->
                <mat-hint align="end">must be 56 characters: {{checkoutSecretKey.value?.length || 0}}/56</mat-hint>

            </form>
            <button mat-button (click)="validateCheckoutSecretKey(checkoutSecretKey.value, stepper)"> Validate Key </button>
        </div>
    </mat-step>
    <!-- End Step Two -->
    <!-- Step Three -->
    <mat-step #stepThree editable="false" [stepControl]="thirdFormGroup">
        <!-- (click)="$event.preventDefault(); alert('jkk');" -->
        <ng-template matStepLabel> Validate Funds </ng-template>
        <div class="col-md-12">
            <form [formGroup]="thirdFormGroup">
                <div class="row">
                    <div class="col-md-4">
                        Wallet Balance Before:
                        <div *ngFor="let balance of balances; index as i" [attr.data-index]="i">
                            <div class="card z-depth-0">
                                <p> Asset {{ i + 1 }}: {{ balance.balance }} {{ balance.asset_type }} </p>
                            </div>
                        </div>
                        <button [class.disabled]="calBalBtnBool" [hidden]="calBalBtnBool" mat-button
                                (click)="calculateFundsForPurchase(stepper.selectedIndex); calBalBtnBool = true" value="calcBal">
                            Show Final Balance
                        </button>
                    </div>
                    <div class="col-md-4">
                        Wallet Balance After
                        <div *ngFor="let balance of updatedBalances; index as i" [attr.data-index]="i">
                            <div class="card z-depth-0">
                                <p> Asset {{ i + 1 }}: {{ balance.balance }} {{ balance.asset_type }} </p>
                            </div>
                        </div>
                        <button [class.disabled]="valBalBtnBool || !calBalBtnBool" [hidden]="valBalBtnBool || !calBalBtnBool" mat-button
                                (click)="validateFundsForPurchase(stepper.selectedIndex); valBalBtnBool = true">
                            Confirm
                        </button>
                    </div>
                    <div class="col-md-4" style="display:flex">
                        <p style="color: red;"> Don't reload page</p>
                        <!-- TODO: LOADING -->
                        <p style="color: red;"> *loading indicator* </p>
                        <mat-checkbox visible="false" hidden="hidden"  formControlName="thirdCtrlFirst"> </mat-checkbox>
                        <button class="primary" [disabled]="cnfPurBtnBool || !valBalBtnBool" [class.disabled]="cnfPurBtnBool || !valBalBtnBool"
                            (click)="completePurchase(stepper); cnfPurBtnBool = true" mat-button> Finalize Purchase</button>
                    </div>
                </div>
            </form>
        </div>
    </mat-step>
    <!-- End Step Three -->
    <mat-step editable="false" #stepFour>
        <ng-template matStepLabel> Confirm </ng-template>
        <h3 > You are now done. Thanks for shopping!</h3>
        <p > Below is your order receipt</p>
        <div>
            <button mat-button (click)="returnHome()"> Return Home </button>
            <button mat-button (click)="checkoutLogout()"> Logout </button>
        </div>
    </mat-step>
</mat-vertical-stepper>
